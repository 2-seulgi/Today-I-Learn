# 트랜잭션이란?

데이터베이스의 상태를 변화시키는 하나의 작업 단위이다. 은행에서 계좌 이체를 생각하면 쉬운데, 만약 내 계좌에서 돈을 빼고 다른 사람 계좌로 돈을 이체하는 두가지의 단계가 모두 실행되거나 둘 다 실패하는게 하나만 실행하고 다른 하나가 실패 하는것보다 낫다. 이처럼 전체 작업이 모두 성공하거나 아니면 전혀 실행되지 않아야 하는 경우 트랜잭션을 사용한다.

## 트랜잭션의 속성

1. **원자성(Atomicity) :** 트랜잭션 내의 모든 작업은 전부 실행되거나, 전혀 실행되지 않아야 한다. 일부가 실행되고 일부는 실패하는 단계는 존재할 수 없다.
2. **일관성(Consistency) :** 트랜잭션이 실행되기 전과 후에 데이터베이스의 일관성이 유지되어야 한다. 즉, 데이터베이스의 모든 규칙을 만족해야 한다.
3. **독립성(Isolation) :** 여러 트랜잭션이 동시에 실행될 때, 각 트랜잭션의 연산은 다른 트랜잭션의 연산으로부터 독립적이여야 한다.
4. **지속성(Durability) :** 트랜잭션이 성공적으로 완료되면, 그 결과는 영구적으로 데이터베이스에 반영되어야 하고, 시스템에 문제가 발생해도 이는 보장되어야 한다.

## 스프링에서의 트랜잭션 관리

- 일반적으로 클래스 또는 메소드 레벨에 @Transaction 어노테이션을 활용한다. 만약 @Transaction 이 부여된 메소드나, 클래스가 호출되는 경우 TransactionManager를 사용하여 트랜잭션을 시작하고, 정상 여부에 따라 Commit 또는 Rollback을 수행한다.

## 기존에 사용하던 트랜잭션 사용의 문제

- 트랜잭션이 컨트롤러에서 서비스를 거쳐 리포지토리로 마지막으로 데이터베이스로 처리되는 스프링부트의 일반적인 트랜잭션 흐름에는 주의해야 하는 몇가지 문제가 있다.

1. **복잡성 및 상용구 발생 문제 :** 코드에서 직접 트랜잭션을 관리하면 반복적인 상용구 코드가 발생할 수 있다.
2. **리소스 관리 :** 트랜잭션 리소스를 수동으로 관리하면 오류가 발생 할 위험이 있다. 데이터베이스 연결이 잘못 처리 되는 경우 리소스가 누출되거나 데이터 베이스 연결 풀이 소진되고 애플리케이션이 중단될 수 있다.
3. **일관성 :** 트랜잭션이 애플리케이션의 여러 부분에서 일관되게 사용되도록 보장하는 것은 어렵고, 특히 대규모 애플리케이션이나 팀에서는 더더욱 그렇다. 여기서 발생하는 불일치로 인해 버그가 발생할 수도 있다.
4. **확장성 :** 다양한 데이터 액세스 기술(JDBC, JPA, Hibernate)을 통합함에 따라 트랜잭션을 수동으로 관리하는 것은 점점 더 불가능해지고 복잡해졌다.
5. **오류 처리 :** 트랜잭션 내에서 올바른 오류 처리가 중요하다. 수동 트랜잭션 관리에는 오류 발생 시 트랜잭션이 롤백되도록 명시적인 점검과 균형이 필요하다.

## TransactionManager 사용의 이점

- 트랜잭션 관리자는 트랜잭션을 관리하는 중앙 집중식 방법을 제공하고, 직접 트랜잭션 관리의 복잡성을 추상화하여 이런 문제를 해결한다.

1. **추상화 및 사용 용이성 :** 트랜잭션 관리자는 트랜잭션 관리의 세부 사항을 추상화한다. 예를 들어 Spring에서 @Transactional 주석은 트랜잭션 시작, 커밋 또는 롤백을 위한 명시적 코딩을 요구하지 않고 트랜잭션 경계를 선언해서 관리 한다.

2. **일관적인 리소스 관리 :** 리소스가 적절하게 관리되고 정리되도록 보장하여 누출 위험 및 기타 리소스 관리 문제를 줄인다.

3. **통합 API :** 다양한 트랜잭션 API 및 데이터 액세스 기술 전반에 걸쳐 일관된 프로그래밍 모델을 제공하여 애플리케이션을 더 쉽게 유지 관리하고 확장할 수 있다.

4. **선언적 트랜잭션 관리 :** 주석이나 구성을 통해 트랜잭션을 선언적으로 관리할 수 있으므로 상용구 코드가 줄어들고 메소드의 트랜잭션 동작이 한눈에 명확해진다.

5. **유연한 구성 :** 전파, 격리 수준, 시간 초과 설정 등과 같은 트랜잭션 동작 구성을 지원하여 트랜잭션을 세밀하게 제어한다.

6. **글로벌 트랜잭션 :** 여러 리소스에 걸쳐 있는 글로벌 트랜잭션 관리를 용이하게 한다.

7. **강력한 오류 처리 :** 런타임 예외가 발생한 경우 트랜잭션 롤백을 자동으로 처리하여 비즈니스 로직에서 수동 오류 처리 없이 데이터 무결성을 보장한다.
